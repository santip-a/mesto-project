(()=>{"use strict";var e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",submitButtonDisabledClass:"form__button_disabled",inputErrorClass:"form__input-error_type_active"};function t(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.querySelector(t.submitButtonSelector);n?(r.classList.remove(t.submitButtonDisabledClass),r.disabled=!1):(r.classList.add(t.submitButtonDisabledClass),r.disabled="disabled")}function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");o(t)}}var r=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",n)},o=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",n)},c={baseUrl:"https://nomoreparties.co/v1/plus-cohort-9",headers:{authorization:"d155811e-206c-4e5d-a1d4-99707bccdbdf","Content-Type":"application/json"}},a=function(e){return e.ok?e.json():Promise.reject(e.status)},i=document.querySelectorAll(".popup"),u=document.querySelector(".popup_type_profile"),s=document.querySelector(".profile__buttom-info"),l=document.forms.form_profile,d=l.elements.name,f=l.elements.character,_=document.querySelector(".profile__title"),m=document.querySelector(".profile__subtitle"),p=document.querySelector(".popup_type_addCard"),h=document.querySelector(".profile__buttom-add"),v=document.forms.form_addCard,y=document.querySelector(".popup_type_openImegeCard"),S=y.querySelector(".popup__title-openImegeCard"),b=y.querySelector(".popup__img"),q=document.querySelector(".popup_type_DelCard"),L=q.querySelector(".form__button"),C=document.querySelector(".popup_type_editAvatar"),E=document.querySelector(".profile__edit-avatar"),g=document.forms.form_editAvatar,k=g.elements.linkAvatar,x="",A=function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__subtitle").textContent=e.about,document.querySelector(".profile__avatar").src=e.avatar,x=e._id};function D(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";t.target.querySelector(".form__button").textContent=n}var U,T=document.querySelector(".cards"),B=document.querySelector("#templateCards").content,P=v.elements.title,w=v.elements.link;function N(e){var t=B.cloneNode(!0);t.querySelector(".cards__text").textContent=e.name,t.querySelector(".cards__image").setAttribute("src",e.link),t.querySelector(".cards__image").setAttribute("alt",e.name),t.querySelector(".cards__like").textContent=e.likes.length;var n=t.querySelector(".cards__heart"),i=t.querySelector(".cards__like");if(e.likes.forEach((function(e){e._id==x&&n.classList.add("cards__heart_active")})),n.addEventListener("click",(function(){var t;n.classList.contains("cards__heart_active")?(t=e._id,fetch("".concat(c.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:c.headers}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){i.textContent=e.likes.length,n.classList.remove("cards__heart_active")})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))}))}(e._id).then((function(e){i.textContent=e.likes.length,n.classList.add("cards__heart_active")}))})),t.querySelector(".cards__image").addEventListener("click",(function(){var t,n;t=e.name,n=e.link,r(y),b.setAttribute("src",n),b.setAttribute("alt",t),S.textContent=t})),e.owner._id===x){var u=t.querySelector(".cards__trash");u.addEventListener("click",(function(){var t,n;t=u.closest(".cards__item"),n=e._id,r(q),L.addEventListener("click",(function(){var e;(e=n,fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(){o(q),t.remove()}))}))})),u.classList.remove("cards__trash_hidden")}return t}function O(e){var t=N(e);T.append(t)}fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))})).then((function(e){e.forEach((function(e){O(e)}))})),U=e,Array.from(document.querySelectorAll(U.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){Array.from(e.querySelectorAll(n.inputSelector)).forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){t.classList.remove("form__input_type_error"),e.querySelector(".".concat(t.id,"-error")).textContent="error",e.querySelector(".".concat(t.id,"-error")).classList.remove(n.inputErrorClass)}(e,t,n):function(e,t,n,r){t.classList.add("form__input_type_error"),e.querySelector(".".concat(t.id,"-error")).textContent=n,e.querySelector(".".concat(t.id,"-error")).classList.add(r.inputErrorClass)}(e,t,t.validationMessage,n)}(e,r,n),t(e,n,e.checkValidity())}))}))}(e,U)})),s.addEventListener("click",(function(){t(u,e),d.value=_.textContent,f.value=m.textContent,r(u)})),l.addEventListener("submit",(function(e){var t,n,r=e.target.querySelector(".form__button").textContent;D(!0,e),e.preventDefault(),(t=d.value,n=f.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){A(e),o(u)})).finally((function(){D(!1,e,r)}))})),h.addEventListener("click",(function(){v.reset(),t(p,e),r(p)})),v.addEventListener("submit",(function(e){var t,n,r=e.target.querySelector(".form__button").textContent;D(!0,e),e.preventDefault(),(t=P.value,n=w.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){O(e),o(p)})).finally((function(){D(!1,e,r)}))})),E.addEventListener("click",(function(){g.reset(),t(C,e),r(C)})),g.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".form__button").textContent;D(!0,e),(t=k.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))}))).then((function(e){document.querySelector(".profile__avatar").src=e.avatar,o(C)})).finally((function(){D(!1,e,n)}))})),i.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&o(e),t.target.classList.contains("popup__button-сlose")&&o(e)}))})),fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then((function(e){return a(e)})).catch((function(e){console.log("Ошибка: ".concat(e))})).then((function(e){A(e)}))})();